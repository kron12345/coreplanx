<section class="personnel-editor">
  <header>
    <mat-button-toggle-group
      color="primary"
      [value]="viewMode()"
      (valueChange)="viewMode.set($event)"
    >
      <mat-button-toggle value="servicePools">
        <mat-icon fontIcon="group_work"></mat-icon>
        Dienstpools
      </mat-button-toggle>
      <mat-button-toggle value="services">
        <mat-icon fontIcon="event"></mat-icon>
        Dienste
      </mat-button-toggle>
      <mat-button-toggle value="personnelPools">
        <mat-icon fontIcon="groups"></mat-icon>
        Personalpools
      </mat-button-toggle>
      <mat-button-toggle value="homeDepots">
        <mat-icon fontIcon="home"></mat-icon>
        Heimdepots
      </mat-button-toggle>
      <mat-button-toggle value="personnel">
        <mat-icon fontIcon="badge"></mat-icon>
        Personal
      </mat-button-toggle>
      <mat-button-toggle value="system">
        <mat-icon fontIcon="delete_sweep"></mat-icon>
        System
      </mat-button-toggle>
    </mat-button-toggle-group>

    <button mat-stroked-button color="warn" type="button" (click)="resetToDefaults()">
      Werkseinstellungen
    </button>
  </header>

  @switch (viewMode()) {
    @case ('servicePools') {
      <app-attribute-entity-editor
        [title]="'Dienstpools'"
        [entities]="servicePoolRecords()"
        [attributeDefinitions]="servicePoolDefinitions()"
        [defaultFallbackValues]="servicePoolDefaults"
        [detailError]="servicePoolError()"
        [requiredKeys]="servicePoolRequiredKeys"
        [selectOptions]="poolSelectOptions()"
        (saveEntity)="handleServicePoolSave($event)"
        (deleteEntities)="handleServicePoolDelete($event)"
      />
    }
    @case ('services') {
      <app-attribute-entity-editor
        [title]="'Dienste'"
        [entities]="serviceRecords()"
        [attributeDefinitions]="serviceDefinitions()"
        [defaultFallbackValues]="serviceDefaults"
        [detailError]="serviceError()"
        [groupedEntities]="serviceGroups()"
        [createDefaultsFactory]="serviceCreateDefaultsFactory"
        [selectOptions]="serviceSelectOptions()"
        (saveEntity)="handleServiceSave($event)"
        (deleteEntities)="handleServiceDelete($event)"
      />
    }
    @case ('personnelPools') {
      <app-attribute-entity-editor
        [title]="'Personalpools'"
        [entities]="personnelPoolRecords()"
        [attributeDefinitions]="personnelPoolDefinitions()"
        [defaultFallbackValues]="personnelPoolDefaults"
        [detailError]="personnelPoolError()"
        [requiredKeys]="personnelPoolRequiredKeys"
        [selectOptions]="poolSelectOptions()"
        (saveEntity)="handlePersonnelPoolSave($event)"
        (deleteEntities)="handlePersonnelPoolDelete($event)"
      />
    }
    @case ('homeDepots') {
      <app-attribute-entity-editor
        [title]="'Heimdepots'"
        [entities]="homeDepotRecords()"
        [attributeDefinitions]="homeDepotDefinitions()"
        [defaultFallbackValues]="homeDepotDefaults"
        [detailError]="homeDepotError()"
        [requiredKeys]="homeDepotRequiredKeys"
        [multiSelectOptions]="homeDepotMultiSelectOptions()"
        (saveEntity)="handleHomeDepotSave($event)"
        (deleteEntities)="handleHomeDepotDelete($event)"
      />
    }
    @case ('personnel') {
      <app-attribute-entity-editor
        [title]="'Personal'"
        [entities]="personnelRecords()"
        [attributeDefinitions]="personnelDefinitions()"
        [defaultFallbackValues]="personnelDefaults"
        [detailError]="personnelError()"
        [groupedEntities]="personnelGroups()"
        [createDefaultsFactory]="personnelCreateDefaultsFactory"
        [selectOptions]="personnelSelectOptions()"
        [multiSelectOptions]="personnelMultiSelectOptions()"
        (saveEntity)="handlePersonnelSave($event)"
        (deleteEntities)="handlePersonnelDelete($event)"
      />
    }
    @case ('system') {
      <div class="system-pools">
        <div class="system-pools__intro">
          System-Pools sind schreibgesch체tzt. Ziehe Eintr채ge in einen Zielpool, um sie wieder zu aktivieren.
        </div>

        <div class="system-pools__section" cdkDropListGroup>
          <div class="system-pool-card">
            <div class="system-pool-card__header">
              <div>
                <div class="system-pool-card__title">{{ systemPoolLabels.personnelServicePool }}</div>
                <div class="system-pool-card__meta">
                  {{ systemServiceItems().length }} Dienste
                </div>
              </div>
            </div>
            <div class="system-pool-card__list" cdkDropList [cdkDropListData]="systemPoolIds.personnelServicePool">
              @if (!systemServiceItems().length) {
                <div class="system-pool-card__empty">Keine Eintr채ge im System-Pool.</div>
              }
              @for (service of systemServiceItems(); track service.id) {
                <div class="system-item" cdkDrag [cdkDragData]="service.id">
                  <div class="system-item__title">{{ service.name }}</div>
                  <div class="system-item__meta">{{ service.id }}</div>
                </div>
              }
            </div>
          </div>
          <div class="system-targets">
            @for (pool of servicePoolTargets(); track pool.id) {
              <div
                class="system-target"
                cdkDropList
                [cdkDropListData]="pool.id"
                (cdkDropListDropped)="handleSystemServiceDrop($event)"
              >
                <div class="system-target__title">{{ pool.name }}</div>
                <div class="system-target__meta">
                  {{ serviceCountByPool().get(pool.id) ?? 0 }} Dienste
                </div>
                <div class="system-target__hint">Hier ablegen</div>
              </div>
            }
          </div>
        </div>

        <div class="system-pools__section" cdkDropListGroup>
          <div class="system-pool-card">
            <div class="system-pool-card__header">
              <div>
                <div class="system-pool-card__title">{{ systemPoolLabels.personnelPool }}</div>
                <div class="system-pool-card__meta">
                  {{ systemPersonnelItems().length }} Personen
                </div>
              </div>
            </div>
            <div class="system-pool-card__list" cdkDropList [cdkDropListData]="systemPoolIds.personnelPool">
              @if (!systemPersonnelItems().length) {
                <div class="system-pool-card__empty">Keine Eintr채ge im System-Pool.</div>
              }
              @for (person of systemPersonnelItems(); track person.id) {
                <div class="system-item" cdkDrag [cdkDragData]="person.id">
                  <div class="system-item__title">{{ formatPersonnelLabel(person) }}</div>
                  <div class="system-item__meta">{{ person.id }}</div>
                </div>
              }
            </div>
          </div>
          <div class="system-targets">
            @for (pool of personnelPoolTargets(); track pool.id) {
              <div
                class="system-target"
                cdkDropList
                [cdkDropListData]="pool.id"
                (cdkDropListDropped)="handleSystemPersonnelDrop($event)"
              >
                <div class="system-target__title">{{ pool.name }}</div>
                <div class="system-target__meta">
                  {{ personnelCountByPool().get(pool.id) ?? 0 }} Personen
                </div>
                <div class="system-target__hint">Hier ablegen</div>
              </div>
            }
          </div>
        </div>
      </div>
    }
  }
</section>
